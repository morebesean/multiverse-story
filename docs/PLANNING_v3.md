# Multiverse v3 — "분기 선택 → 평행우주의 나와 대화 → 결과 공유"

기획 A(Multiverse Chat) + C(Multiverse Timeline) 조합

---

## 1. 서비스 한 줄 정의

**"인생의 갈림길을 선택하고, 그 길을 걸어간 또 다른 나와 대화하세요."**

영문: "Choose a different path. Meet the you who took it."

---

## 2. 핵심 플로우 (5단계)

```
[1. 프로필]  →  [2. 분기 선택]  →  [3. 페르소나 생성 + 광고]  →  [4. 대화]  →  [5. 결과 + 공유]
   10초            15초              5~7초(광고)              자유시간          결과생성+광고
```

### Stage 1: 프로필 입력 (`/create`)
**목표:** 최소 정보로 빠르게 시작 (10초 이내)

- 닉네임 (텍스트, 필수)
- 나이대 (10대/20대/30대/40대/50대+ 버튼 선택)
- 성별 (선택사항, 남/여/기타/패스)

**디자인:** 한 화면에 모두 표시. 하단 "다음" 버튼.

---

### Stage 2: 분기점 선택 (`/branch`)
**목표:** "What If"을 직접 쓰지 않고 탭으로 선택 + 커스텀 가능

**2단계 선택:**

**Step 2-1: 카테고리 선택** (큰 카드 4~6개)
- 💼 커리어 & 직업
- 💕 사랑 & 관계
- 🌍 장소 & 환경
- 📚 교육 & 성장
- 💰 돈 & 라이프스타일
- 🎲 운명의 장난 (랜덤)

**Step 2-2: 구체적 시나리오 선택** (카테고리별 3~4개)
예) "커리어 & 직업" 선택 시:
- "전혀 다른 직업을 선택했다면?"
- "창업을 했다면?"
- "해외에서 일했다면?"
- ✏️ 직접 입력

**+ 무드 선택** (분위기 톤)
- 😊 따뜻하게 (Warm)
- 🎬 드라마틱하게 (Dramatic)
- 🌙 현실적으로 (Realistic)
- 😈 냉소적으로 (Cynical)

**핵심:** 카테고리 탭 1번 + 시나리오 탭 1번 + 무드 탭 1번 = 3탭이면 완료

---

### Stage 3: 페르소나 생성 + 광고 (`/loading`)
**목표:** AI가 "평행우주의 나" 캐릭터를 생성하는 동안 광고 노출

**소요 시간:** 최소 7초 (광고 노출 보장)

**화면 구성:**
```
┌─────────────────────────────┐
│                             │
│   [AdSense 배너 광고]        │
│   (300x250 또는 반응형)      │
│                             │
├─────────────────────────────┤
│                             │
│   🌀 "평행우주를 탐색 중..."  │
│                             │
│   ████████████░░░  78%      │
│   프로그레스 바               │
│                             │
│   💡 "알고 계셨나요?          │
│   양자역학에 의하면 우리의     │
│   모든 선택은 실제로..."      │
│                             │
└─────────────────────────────┘
```

**로딩 메시지 로테이션 (5개):**
1. "평행우주의 차원문을 여는 중..."
2. "또 다른 당신을 찾고 있어요..."
3. "시간선을 분석하는 중..."
4. "평행우주 좌표를 계산 중..."
5. "당신의 또 다른 인생을 불러오는 중..."

**AI 처리:**
- 사용자 프로필 + 선택한 분기점으로 페르소나 생성
- 페르소나에는 이름, 직업, 성격, 말투, 현재 상황 등 포함
- 이후 대화에서 이 페르소나가 일관되게 대화

---

### Stage 4: 대화 (`/chat`)
**목표:** 평행우주의 나와 감정적으로 깊은 대화

**기본 구조: 3턴 무료 + 광고 후 3턴 추가**

```
┌─────────────────────────────┐
│  🌌 Universe #DRIFT-07      │
│  "시인이 된 나" 와의 대화     │
├─────────────────────────────┤
│                             │
│  [페르소나 첫 인사 메시지]    │
│  "안녕, 나야. 정확히는        │
│  다른 선택을 한 너지.         │
│  궁금한 거 있어?"            │
│                             │
│         [사용자 입력]    →   │
│                             │
│  [페르소나 응답]             │
│  ...                        │
│                             │
├─────────────────────────────┤
│  💬 3/3 대화 남음            │
│  [메시지 입력창]         [→] │
└─────────────────────────────┘
```

**대화 흐름:**

**무료 3턴:**
- 턴 1: 자유 대화 (사용자가 궁금한 것 질문)
- 턴 2: 자유 대화
- 턴 3: 자유 대화
- → 3턴 소진 시 선택지:
  - **[A] 광고 보고 3턴 더 대화하기** ← 보상형 광고
  - **[B] 대화 마무리하고 결과 보기** ← 결과 페이지로

**추가 3턴 (광고 시청 후):**
- 턴 4~6: 추가 대화
- 마지막 턴에서 페르소나가 자연스럽게 작별 인사
- → 자동으로 결과 페이지로 이동

**대화 품질 관리:**
- 각 응답은 2~4문장 (너무 길지 않게)
- 페르소나의 말투/성격이 일관되게 유지
- 감정적으로 깊은 질문에 진정성 있게 답변
- 마지막 턴에서는 현실의 사용자에게 따뜻한 메시지

**AI 구현:**
- 대화는 streaming으로 실시간 표시
- 시스템 프롬프트에 페르소나 정보 주입
- 대화 히스토리를 컨텍스트로 유지
- 턴 수 카운트는 클라이언트에서 관리

---

### Stage 5: 결과 & 공유 (`/result`)
**목표:** 전체 대화를 정리한 감성적 결과물 + 공유

**결과 생성:** 대화 종료 시 AI가 전체 대화 내용을 분석하여 결과 생성 (이 과정에서 광고)

**결과 구성:**

```
┌─────────────────────────────┐
│  🌌 Universe #DRIFT-07      │
│  ──────────────────────────  │
│  "시인이 된 나"              │
│  "당신이 펜을 잡았던 그 순간, │
│   모든 것이 달라졌습니다"     │
├─────────────────────────────┤
│                             │
│  📊 평행우주 프로필           │
│  ┌─────────┬──────────┐     │
│  │ 현실의 나 │ 그곳의 나 │     │
│  ├─────────┼──────────┤     │
│  │ 개발자   │ 시인      │     │
│  │ 서울    │ 제주도    │     │
│  │ ...     │ ...      │     │
│  └─────────┴──────────┘     │
│                             │
├─────────────────────────────┤
│                             │
│  💬 Best Moment              │
│  "가장 인상적인 대화 한 마디" │
│  ── 평행우주의 나 ──          │
│                             │
├─────────────────────────────┤
│                             │
│  📝 평행우주에서 온 편지       │
│  "나에게..."                 │
│  (AI가 전체 대화를 바탕으로   │
│   작성한 감성적 편지)         │
│                             │
├─────────────────────────────┤
│                             │
│  [AdSense 광고]              │
│                             │
├─────────────────────────────┤
│                             │
│  [🔗 공유하기]  [🔄 다시하기] │
│                             │
│  💡 다른 선택도 해보세요:      │
│  [사랑을 선택했다면?]         │
│  [해외에서 살았다면?]         │
│  [랜덤 우주 열기]            │
│                             │
└─────────────────────────────┘
```

**결과 항목:**
1. **우주 ID + 타이틀** — "시인이 된 나", "파리에서 사는 나" 등
2. **한 줄 요약** — 감성적 태그라인
3. **비교 프로필** — 현실 vs 평행우주 (나란히 비교)
4. **Best Moment** — 대화 중 가장 인상적인 한 마디 (AI 선별)
5. **평행우주에서 온 편지** — 전체 대화를 바탕으로 AI가 작성한 짧은 편지
6. **다른 선택 추천** — 재방문 유도용 다른 시나리오 3개

---

## 3. 광고 수익화 전략

### 광고 삽입 포인트 (총 3회 보장, 최대 4회)

| 시점 | 형태 | 노출 시간 | 필수 여부 |
|------|------|----------|----------|
| ① 페르소나 생성 중 | 배너 광고 | 7초 | 필수 |
| ② 3턴 소진 후 | 보상형 광고 (선택) | 5~15초 | 선택 |
| ③ 결과 생성 중 | 배너 광고 | 5초 | 필수 |
| ④ 결과 페이지 내 | 인라인 배너 | 상시 | 필수 |

**예상 시나리오:**
- 최소 경로 (광고 안 보고 바로 결과): 광고 3회 노출
- 일반 경로 (광고 보고 추가 대화): 광고 4회 노출
- 재플레이 시: 추가 3~4회

### AdSense 구현 참고
- 보상형 광고는 AdSense에서 직접 지원하지 않으므로, "추가 대화" 선택 시 전면 배너를 5초간 표시하는 방식으로 대체
- 또는 Google AdMob 웹 SDK 연동 (보상형 광고 지원)

---

## 4. 공유 기능

### 공유 콘텐츠
- **텍스트:** 우주 ID + 타이틀 + Best Moment 한 마디 + 사이트 URL
- **이미지:** OG 이미지 동적 생성 (우주 이름 + 한줄 요약 + Best Moment)
- **URL:** 고유 결과 URL (데이터 압축 or 서버 저장)

### 공유 채널
- 링크 복사
- Twitter/X
- WhatsApp
- 카카오톡 (한국)
- 이미지 다운로드 (인스타그램 스토리용)

### 바이럴 루프
```
사용자 A 결과 공유 → 친구 B가 링크 클릭 → B가 결과 확인
→ "나도 해보기" CTA → B가 자기 것 생성 → B가 공유 → ...
```

---

## 5. AI 구현 설계

### API 엔드포인트

**1) POST `/api/persona` — 페르소나 생성**
```json
// Request
{
  "nickname": "지민",
  "ageGroup": "20s",
  "gender": "female",
  "category": "career",
  "scenario": "became_artist",
  "mood": "warm"
}

// Response
{
  "universeId": "DRIFT-CANVAS-07",
  "title": "화가가 된 나",
  "persona": {
    "name": "지민",
    "age": 27,
    "job": "프리랜서 일러스트레이터",
    "location": "홍대 작업실",
    "personality": "자유분방하고 감성적, 약간 몽상가",
    "speakingStyle": "편한 반말, 가끔 시적인 표현",
    "currentSituation": "첫 개인전을 준비 중",
    "coreMemory": "대학 1학년 때 경영학 수업 대신 미술 수업을 들었던 날"
  },
  "greeting": "안녕, 나야... 아니, 정확히는 다른 길을 걸어온 너지. 신기하다, 이렇게 만나게 될 줄은. 뭐가 궁금해?"
}
```

**2) POST `/api/chat` — 대화**
```json
// Request
{
  "persona": { ... },  // 페르소나 정보
  "messages": [         // 대화 히스토리
    { "role": "assistant", "content": "안녕, 나야..." },
    { "role": "user", "content": "거기서 행복해?" }
  ],
  "turnNumber": 2,
  "maxTurns": 3         // or 6 if extended
}

// Response (streaming)
{
  "content": "행복이라... 매일 아침 캔버스 앞에 서면 설레긴 해. 근데 솔직히 월세 걱정에 잠 못 드는 날도 많아. 그래도 네가 궁금하더라. 거기서 사무실 다니면서 안정적이긴 해?",
  "isLastTurn": false
}
```

**3) POST `/api/summary` — 결과 생성**
```json
// Request
{
  "persona": { ... },
  "fullConversation": [ ... ],
  "userProfile": { ... }
}

// Response
{
  "universeId": "DRIFT-CANVAS-07",
  "title": "화가가 된 나",
  "oneLiner": "캔버스 위의 자유와 현실의 무게 사이에서",
  "comparison": {
    "reality": { "job": "개발자", "location": "판교", ... },
    "multiverse": { "job": "일러스트레이터", "location": "홍대", ... }
  },
  "bestMoment": {
    "speaker": "multiverse",
    "quote": "매일 아침 캔버스 앞에 서면 설레긴 해. 근데 솔직히 월세 걱정에 잠 못 드는 날도 많아."
  },
  "letter": "나에게,\n\n우리가 갈라선 그 날을 기억해? 네가 안정을 선택한 건 틀린 게 아니야...",
  "suggestedScenarios": [
    { "category": "love", "scenario": "confessed_love", "label": "그때 고백했다면?" },
    { "category": "place", "scenario": "lived_abroad", "label": "해외에서 살았다면?" },
    { "category": "random", "scenario": "random", "label": "🎲 랜덤 우주" }
  ]
}
```

### 프롬프트 설계 핵심

**페르소나 생성 프롬프트:**
- 사용자와 같은 사람이되 다른 선택을 한 버전
- 현실적인 트레이드오프 (유토피아 금지)
- 일관된 성격과 말투 설정
- 사용자 입력 언어와 동일한 언어로 생성

**대화 프롬프트:**
- 페르소나의 성격/말투 일관성 유지
- 2~4문장 길이 (너무 길지 않게)
- 감정적 깊이 있는 대화 유도
- 마지막 턴에서 자연스러운 작별 + 의미 있는 한 마디

**결과 생성 프롬프트:**
- 전체 대화에서 가장 인상적인 순간 선별
- 비교 프로필 추론
- 감성적인 편지 작성 (200~300자)

---

## 6. 기술 스택 & 구현 계획

### 기존 유지
- Next.js 16 + React 19 + TypeScript + Tailwind CSS
- Vercel 배포 + Edge Runtime
- OpenAI GPT-4o

### 추가 필요
- **Vercel AI SDK** `useChat` 또는 직접 streaming 구현 (대화용)
- **lz-string** — 결과 데이터 압축 (URL 공유용)
- 또는 **Vercel KV / Upstash Redis** — 결과 저장 (간단한 KV store)

### 파일 구조 (예상)

```
src/
├── app/
│   ├── page.tsx                    # 랜딩
│   ├── create/page.tsx             # Stage 1: 프로필
│   ├── branch/page.tsx             # Stage 2: 분기점 선택
│   ├── loading/page.tsx            # Stage 3: 페르소나 생성 + 광고
│   ├── chat/page.tsx               # Stage 4: 대화
│   ├── result/page.tsx             # Stage 5: 결과
│   ├── result/[id]/page.tsx        # 공유된 결과 보기
│   ├── api/
│   │   ├── persona/route.ts        # 페르소나 생성
│   │   ├── chat/route.ts           # 대화 (streaming)
│   │   ├── summary/route.ts        # 결과 생성
│   │   └── og/route.tsx            # OG 이미지
│   ├── privacy/page.tsx            # 개인정보처리방침
│   ├── terms/page.tsx              # 이용약관
│   └── about/page.tsx              # About
├── components/
│   ├── chat/
│   │   ├── chat-interface.tsx      # 채팅 UI
│   │   ├── message-bubble.tsx      # 메시지 말풍선
│   │   └── turn-counter.tsx        # 남은 턴 표시
│   ├── branch/
│   │   ├── category-cards.tsx      # 카테고리 선택 카드
│   │   └── scenario-cards.tsx      # 시나리오 선택 카드
│   ├── result/
│   │   ├── comparison-card.tsx     # 비교 프로필
│   │   ├── best-moment-card.tsx    # Best Moment
│   │   ├── letter-card.tsx         # 편지
│   │   └── share-buttons.tsx       # 공유 버튼
│   ├── ad-banner.tsx               # 광고
│   ├── ad-wall.tsx                 # 보상형 광고 벽
│   ├── header.tsx                  # 헤더
│   └── ui/                         # 기본 UI 컴포넌트
├── lib/
│   ├── scenarios.ts                # 카테고리별 시나리오 데이터
│   ├── types.ts                    # 타입 정의
│   ├── prompts.ts                  # AI 프롬프트 템플릿
│   └── utils.ts                    # 유틸리티
└── locales/                        # 다국어 번역 파일
```

---

## 7. 구현 우선순위

### Phase 1: 핵심 플로우 (MVP)
1. 프로필 입력 페이지 (`/create`)
2. 분기점 선택 페이지 (`/branch`) — 카테고리 + 시나리오
3. 페르소나 생성 API (`/api/persona`)
4. 대화 API (`/api/chat`) — streaming
5. 대화 UI (`/chat`) — 3턴 무료 + 광고 후 3턴 추가
6. 결과 생성 API (`/api/summary`)
7. 결과 페이지 (`/result`)

### Phase 2: 수익화 + 공유
8. 로딩 화면 + AdSense 광고
9. 보상형 광고 벽 (추가 대화용)
10. 결과 페이지 내 광고
11. 공유 기능 (링크 복사 + 소셜)
12. OG 이미지 생성

### Phase 3: 랜딩 + 글로벌
13. 랜딩 페이지 재설계
14. 다국어 지원 (번역 파일 분리)
15. 시나리오 현지화
16. SEO + 법적 페이지

### Phase 4: 성장
17. 결과 히스토리 (localStorage)
18. 다른 시나리오 추천
19. 결과 URL 공유 (서버 저장 or 압축)

---

## 8. UX 핵심 원칙

1. **3탭 원칙** — 시작부터 대화까지 최소 3번의 탭으로 도달
2. **감정 우선** — 모든 텍스트는 감정적 울림을 주도록
3. **로딩 ≠ 기다림** — 로딩 시간을 콘텐츠 소비 시간으로 전환
4. **공유 욕구** — 결과물이 "이거 봐봐!" 하고 싶게 만들기
5. **다음이 궁금** — 항상 "다른 선택은?" 으로 재방문 유도

---

## 9. 검증 방법
- `npm run dev`로 전체 플로우 테스트
- 프로필 → 분기 선택 → 로딩 → 대화 3턴 → 광고 → 추가 대화 → 결과
- 대화 streaming 정상 동작 확인
- 광고 노출 타이밍/위치 확인
- 공유 링크 생성 및 복원
- 모바일 반응형 (채팅 UI 특히 중요)
- 다국어 전환
